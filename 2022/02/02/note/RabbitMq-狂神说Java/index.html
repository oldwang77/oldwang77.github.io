<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wangfx.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="RabbitMq-狂神说Java">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMq-狂神说Java">
<meta property="og:url" content="http://wangfx.top/2022/02/02/note/RabbitMq-%E7%8B%82%E7%A5%9E%E8%AF%B4Java/index.html">
<meta property="og:site_name" content="浅光">
<meta property="og:description" content="RabbitMq-狂神说Java">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210315214723.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320123013.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320143840.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320144337.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320144829.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320163852.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320163914.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320164533.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320170420.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320164852.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320170831.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320201634.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320204116.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320204157.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320204912.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320214218.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320220922.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320221811.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321092951.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321093040.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321104320.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321112301.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323200758.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323204334.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323204908.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323204915.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323205324.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323205544.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323205635.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323212142.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323212721.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323221928.png">
<meta property="og:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323222006.png">
<meta property="article:published_time" content="2022-02-02T13:59:04.000Z">
<meta property="article:modified_time" content="2022-07-16T14:23:22.917Z">
<meta property="article:author" content="qianguang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210315214723.png">

<link rel="canonical" href="http://wangfx.top/2022/02/02/note/RabbitMq-%E7%8B%82%E7%A5%9E%E8%AF%B4Java/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>RabbitMq-狂神说Java | 浅光</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">浅光</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">执着于理想，纯粹于当下</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://wangfx.top/2022/02/02/note/RabbitMq-%E7%8B%82%E7%A5%9E%E8%AF%B4Java/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qianguang">
      <meta itemprop="description" content="浅光的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅光">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RabbitMq-狂神说Java
        </h1>

        <div class="post-meta">
		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-02 21:59:04" itemprop="dateCreated datePublished" datetime="2022-02-02T21:59:04+08:00">2022-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-16 22:23:22" itemprop="dateModified" datetime="2022-07-16T22:23:22+08:00">2022-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%90%8E%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">web后端</span></a>
                </span>
            </span>

          
            <div class="post-description">RabbitMq-狂神说Java</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="RabbitMq-狂神说Java"><a href="#RabbitMq-狂神说Java" class="headerlink" title="RabbitMq-狂神说Java"></a>RabbitMq-狂神说Java</h1><h2 id="1-什么是中间件"><a href="#1-什么是中间件" class="headerlink" title="1 什么是中间件"></a>1 什么是中间件</h2><p>​	中间件需要有通讯功能、高可用、遵循某种规范、持久性<br>​	RMI：远程系统调用<br>​	屏蔽底层操作系统复杂性，我们不需要关注底层是如何互联互通的，我们只需要使用就可以<br>使用了中间件技术可以让我们系统更加灵活方便，如果是单体架构，那么用户系统，订单系统，支付系统都必须使用Java进行开发，使用了中间件可以使用php开发支付，go开发订单</p>
<img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210315214723.png" alt="image-20210315214716366" style="zoom:67%;" />

<h2 id="2-中间件以及架构技术"><a href="#2-中间件以及架构技术" class="headerlink" title="2 中间件以及架构技术"></a>2 中间件以及架构技术</h2><h3 id="分布式中间件"><a href="#分布式中间件" class="headerlink" title="分布式中间件"></a>分布式中间件</h3><p>ActiveMQ目前以及不再流行了<br><strong>RabbitMQ</strong>目前美团、滴滴都在使用，并且和SpringBoot是同一家族开发的，支持更完善<br>Kafka性能最高的，大数据领域<br>RocketMQ是阿里，滴滴国产开发的，开源和半开源，不稳定，不推荐</p>
<h3 id="负载均衡中间件"><a href="#负载均衡中间件" class="headerlink" title="负载均衡中间件"></a>负载均衡中间件</h3><p>Nginx<br>CDN一定要去了解！<br>LVS负载均衡软件<br>KeepAlive</p>
<h3 id="缓存中间件"><a href="#缓存中间件" class="headerlink" title="缓存中间件"></a>缓存中间件</h3><p>MemCache较小项目中可以使用缓存，类似一个Map，数据写入JVM中<br>Redis</p>
<h3 id="数据库中间件"><a href="#数据库中间件" class="headerlink" title="数据库中间件"></a>数据库中间件</h3><p>Mycat<br>ShardingJdbc</p>
<h2 id="3-基于消息中间件的分布式系统的架构"><a href="#3-基于消息中间件的分布式系统的架构" class="headerlink" title="3 基于消息中间件的分布式系统的架构"></a>3 基于消息中间件的分布式系统的架构</h2><h2 id="4-消息队列协议"><a href="#4-消息队列协议" class="headerlink" title="4 消息队列协议"></a>4 消息队列协议</h2><p>AMQP协议，是在TCP&#x2F;IP协议的基础上，是RabbitMQ采用的方式<br>消息中间件不用http协议，常见的消息中间件协议有OpenWire，AMQP、MQTT、Kafka</p>
<p>Q:为什么不直接用http协议<br>因为消息中间件追求性能的极致，简单，快速。http协议的报文头和响应是相对比较复杂的，包含了cookie,数据的加密解密，响应码等附加的功能，实际上我们不需要这么复杂的功能<br>此外，大部分http都是短连接，实际的交互过程中，一个请求到响应很可能会中断，中断后就不会维持持久化，不利于数据的传输</p>
<h3 id="AMQP协议"><a href="#AMQP协议" class="headerlink" title="AMQP协议"></a>AMQP协议</h3><p>AMQP是高级消息队列协议，支持者RabbitMQ和ACTIVEMQ</p>
<h2 id="5-消息队列持久化"><a href="#5-消息队列持久化" class="headerlink" title="5 消息队列持久化"></a>5 消息队列持久化</h2><h2 id="6-消息的分发策略"><a href="#6-消息的分发策略" class="headerlink" title="6 消息的分发策略"></a>6 消息的分发策略</h2><p>发布订阅<br>轮询分发：无论你的服务器的性能怎么样，都是公平的<br>公平分发：数据会倾斜，消费能力高的，就会多消费<br>重发<br>消息拉取</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320123013.png" alt="image-20210320123006738"></p>
<h2 id="7-消息的高可用和高可靠"><a href="#7-消息的高可用和高可靠" class="headerlink" title="7 消息的高可用和高可靠"></a>7 消息的高可用和高可靠</h2><p>高可用，在足够长的时间里，比如一年的时间里，一个服务可用的时间，服务可用时间越长越好。一般用可服务时间除于总时间算出一个百分比，用百分比作为度量。比如一个服务如果有5个9的可用性，指的就是一年里99.999%时间里服务都是可用的。<br>高可靠，无论服务器处于什么故障，比如一个系统突然崩溃，报错，异常，都不能影响线上业务的正常运行，出错率极低，称之为高可靠</p>
<p>有两个极端的例子可以很好的说明这两个概念的区别:</p>
<ol>
<li>假想一个服务，可靠性很高，平均来说可以稳定运行10年，但是一旦服务中断，要用一年的时间来恢复，那么它的可用性只有90%。</li>
<li>假想另一个服务，可靠性很差，运行10秒就会宕机，但是恢复服务只需要1ms, 那么它的可用性是99.99%</li>
</ol>
<p>如何保证可靠性呢？<br>1 消息的传输：通过协议保证系统间数据解析的正确性<br>2 消息的存储可靠：通过持久化来保证消息的可靠性</p>
<p>对于集群模式，归根到底三句话：<br>1：要么消息共享，<br>2：要么消息同步<br>3：要么元数据共享</p>
<h2 id="8-RabbitMQ入门和安装"><a href="#8-RabbitMQ入门和安装" class="headerlink" title="8 RabbitMQ入门和安装"></a>8 RabbitMQ入门和安装</h2><p>官网：<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a><br>简单概述：<br>RabbitMQ是一个开源的遵循AMQP协议实现的基于Erlang语言编写，支持多种客户端（语言）。用于在分布式系统中存储消息，转发消息，具有高可用，高可扩性，易用性等特征。</p>
<h3 id="安装rabbitMQ"><a href="#安装rabbitMQ" class="headerlink" title="安装rabbitMQ"></a>安装rabbitMQ</h3><p>1：下载地址：<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a><br>2：环境准备：CentOS7.x+ &#x2F; Erlang<br>RabbitMQ是采用Erlang语言开发的，所以系统环境必须提供Erlang环境，第一步就是安装Erlang。</p>
<h2 id="9-web图像化安装"><a href="#9-web图像化安装" class="headerlink" title="9 web图像化安装"></a>9 web图像化安装</h2><h2 id="10-docker安装rabbitMQ"><a href="#10-docker安装rabbitMQ" class="headerlink" title="10 docker安装rabbitMQ"></a>10 docker安装rabbitMQ</h2><p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320143840.png" alt="image-20210320143840501"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name myrabbit -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin -p 15672:15672 -p 5672:5672 -p 25672:25672 -p 61613:61613 -p 1883:1883 rabbitmq:management</span><br></pre></td></tr></table></figure>

<p>创建docker容器并运行<br>此时会自动帮我们安装好rabbitmq和rabbitmq的图形化界面，同时开放端口和账号和密码<br><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320144337.png" alt="image-20210320144337580"></p>
<p>我们去浏览器访问一下图形管理界面<a target="_blank" rel="noopener" href="http://47.116.131.130:15672/">http://47.116.131.130:15672/</a><br>登录的账号和密码都是admin</p>
<p>我们可以查看一下我们当前RabbitMQ的运行状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status rabbitmq</span><br></pre></td></tr></table></figure>

<h2 id="11-RabbitMQ角色分类"><a href="#11-RabbitMQ角色分类" class="headerlink" title="11 RabbitMQ角色分类"></a>11 RabbitMQ角色分类</h2><p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320144829.png" alt="image-20210320144829350"></p>
<h2 id="12-rabbitMQ入门案例-simple简单模式"><a href="#12-rabbitMQ入门案例-simple简单模式" class="headerlink" title="12 rabbitMQ入门案例 -simple简单模式"></a>12 rabbitMQ入门案例 -simple简单模式</h2><p>持久化消息会存盘；非持久化信息也会存盘，但是会随着服务器重启而丢失</p>
<h2 id="13-什么是AMQP"><a href="#13-什么是AMQP" class="headerlink" title="13 什么是AMQP"></a>13 什么是AMQP</h2><p>Q：rabbitmq为什么是基于通道处理的，而不是通过连接处理的呢？<br>因为连接需要经过三次握手，每次都通过连接很慢。<br>我们连接采用长连接，一次连接过程有多次通道，高并发的时候很快</p>
<p>AMQP全称：Advanced Message Queuing Protocol(高级消息队列协议)。是应用层协议的一个开发标准，为面向消息的中间件设计。</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320163852.png" alt="image-20210320163852739"></p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320163914.png" alt="image-20210320163914915"></p>
<h2 id="14-RabibitMQ的核心组成"><a href="#14-RabibitMQ的核心组成" class="headerlink" title="14 RabibitMQ的核心组成"></a>14 RabibitMQ的核心组成</h2><p>Q：可以存在没有交换机的队列嘛？<br>不可能<br><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320164533.png" alt="image-20210320164533148"></p>
<p>队列接收到的消息都是通过交换机得到的，如果我们在程序中没有指定交换机，那么这个队列就会绑定在默认的交换机上<br>Routing key:作为一个消息发送的条件，消息队列中的消息我只想发给course，就增加条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where routing key = course</span><br></pre></td></tr></table></figure>

<img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320170420.png" alt="image-20210320170420744" style="zoom:50%;" />

<p>核心概念：<br><strong>Server</strong>：又称<strong>Broker</strong> ,接受客户端的连接，实现AMQP实体服务。 安装rabbitmq-server<br><strong>Connection</strong>：连接，应用程序与Broker的网络连接 TCP&#x2F;IP&#x2F; 三次握手和四次挥手<br><strong>Channel</strong>：网络信道，几乎所有的操作都在Channel中进行，Channel是进行消息读写的通道，客户端可以建立对各Channel，每个Channel代表一个会话任务。<br><strong>Message</strong> :消息：服务与应用程序之间传送的数据，由Properties和body组成，Properties可是对消息进行修饰，比如消息的优先级，延迟等高级特性，Body则就是消息体的内容。<br><strong>Virtual Host</strong> 虚拟地址，用于进行逻辑隔离，最上层的消息路由，一个虚拟主机理由可以有若干个Exhange和Queueu，同一个虚拟主机里面不能有相同名字的Exchange<br><strong>Exchange</strong>：交换机，接受消息，根据路由键发送消息到绑定的队列。(不具备消息存储的能力)<br><strong>Bindings</strong>：Exchange和Queue之间的虚拟连接，binding中可以保护多个routing key.<br><strong>Routing key</strong>：是一个路由规则，虚拟机可以用它来确定如何路由一个特定消息。<br><strong>Queue</strong>：队列：也成为Message Queue,消息队列，保存消息并将它们转发给消费者。</p>
<h3 id="RabbitMQ整体架构"><a href="#RabbitMQ整体架构" class="headerlink" title="RabbitMQ整体架构"></a>RabbitMQ整体架构</h3><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320164852.png" alt="img" style="zoom: 50%;" />

<h3 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h3><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320170831.png" alt="img" style="zoom:67%;" />

<p><strong>任何队列都要绑定交换机</strong>，没有指定的话就会绑定默认的交换机，一定要有交换机。消息是通过交换机放到队列里的</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320201634.png" alt="image-20210320201634815"></p>
<h2 id="15-发布订阅模式-fanout模式"><a href="#15-发布订阅模式-fanout模式" class="headerlink" title="15 发布订阅模式-fanout模式"></a>15 发布订阅模式-fanout模式</h2><p>​		飞哥代码里并没有去绑定交换机和队列，是因为飞哥是在web控制页面进行了队列和交换机的绑定！我们可以发现通过web控制页面绑定可以减少代码<br>​		只要队列有人进行订阅，那么交换机投递消息到所有队列</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320204116.png" alt="image-20210320204116710"></p>
<h2 id="16-路由模式-direct模式"><a href="#16-路由模式-direct模式" class="headerlink" title="16 路由模式-direct模式"></a>16 路由模式-direct模式</h2><p>每个队列绑定一个路由名，当交换机发送信息的时候，必须指定发送的路由信息才可以发送出去</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320204157.png" alt="image-20210320204157307"></p>
<h2 id="17-主题模式-topic模式"><a href="#17-主题模式-topic模式" class="headerlink" title="17 主题模式-topic模式"></a>17 主题模式-topic模式</h2><p>支持模糊匹配的路由key<br>消息队列首先设置交换机和队列的关系（routingKey），然后交换机定义模糊查询的key,通过模糊查询，进行消息的插入</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320204912.png" alt="image-20210320204912919"></p>
<h2 id="18-work模式-轮训模式"><a href="#18-work模式-轮训模式" class="headerlink" title="18 work模式-轮训模式"></a>18 work模式-轮训模式</h2><h2 id="19-work模式-公平分发模式"><a href="#19-work模式-公平分发模式" class="headerlink" title="19 work模式-公平分发模式"></a>19 work模式-公平分发模式</h2><p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320214218.png" alt="img"></p>
<p>当有多个消费者时，我们的消息会被哪个消费者消费呢，我们又该如何均衡消费者消费信息的多少呢?<br>主要有两种模式：<br>1、轮询模式的分发：一个消费者一条，按均分配；<br>2、公平分发：根据消费者的消费能力进行公平分发，处理快的处理的多，处理慢的处理的少；按劳分配；</p>
<p>总结：<br>（1）当队列里消息较多时，我们通常会开启多个消费者处理消息；公平分发和轮询分发都是我们经常使用的模式。<br>（2）轮询分发的主要思想是“按均分配”，不考虑消费者的处理能力，所有消费者均分；这种情况下，处理能力弱的服务器，一直都在处理消息，而处理能力强的服务器，在处理完消息后，处于空闲状态；<br>(3) 公平分发的主要思想是”能者多劳”，按需分配，能力强的干的多。</p>
<h2 id="20-RabbitMQ使用场景"><a href="#20-RabbitMQ使用场景" class="headerlink" title="20 RabbitMQ使用场景"></a>20 RabbitMQ使用场景</h2><p>rabbitmq主要是通过erlang语言实现的，erlang语言是开发电信设备的，所以rabbitmq中很重要的概念就是交换机</p>
<p><strong>Q：面试官问你为什么使用RabbitMQ</strong><br>我在2020年在某个公司实习，公司项目开始采用的是单体架构，但是随着发展，架构师迭代开发版本，设计分布式的架构，此时不同模块间需要进行通信，因此采用了rabbitmq作为消息中间件。</p>
<p>自己使用RabbitMQ的感觉话，最核心的是它是一个异步的，因为它是一个分发，多线程的机制，可以让我们的网站性能成倍的提升，因为有了异步，可以让性能得到极大的提升</p>
<h3 id="解耦、削峰、异步"><a href="#解耦、削峰、异步" class="headerlink" title="解耦、削峰、异步"></a>解耦、削峰、异步</h3><p>同步执行的代码</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320220922.png" alt="image-20210320220922340"></p>
<p>异步消息队列的方式</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210320221811.png" alt="image-20210320221811509"></p>
<p>什么是削峰</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321092951.png" alt="image-20210321092951035"></p>
<h3 id="高内聚、低耦合"><a href="#高内聚、低耦合" class="headerlink" title="高内聚、低耦合"></a>高内聚、低耦合</h3><p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321093040.png" alt="img"></p>
<p>04、分布式事务的可靠消费和可靠生产<br>05、索引、缓存、静态化处理的数据同步<br>06、流量监控<br>07、日志监控（ELK）<br>08、下单、订单分发、抢票</p>
<h2 id="21-SpringBoot案例-fanout模式"><a href="#21-SpringBoot案例-fanout模式" class="headerlink" title="21 SpringBoot案例- fanout模式"></a>21 SpringBoot案例- fanout模式</h2><p>短信服务、邮件服务、sms服务如何和消息队列进行绑定呢？这里我们通过<img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321104320.png" alt="image-20210321104320801"></p>
<p>@RabbitListener这个注解来实现</p>
<h2 id="22-springboot案例-direct模式"><a href="#22-springboot案例-direct模式" class="headerlink" title="22 springboot案例-direct模式"></a>22 springboot案例-direct模式</h2><p>Q：京东的问题，我们在开发的过程中，配置的申明是配置在生产者这里好一点还是配置在消费者这里好一点？</p>
<p>理论上来说，对于配置来说都可以，或者两边都配置也可以<br>不过，在消费者这端配置认为相对更好一点，因为队列如果没有声明，启动消费者这边的服务会报错</p>
<h2 id="23-SpringBoot案例-topic模式"><a href="#23-SpringBoot案例-topic模式" class="headerlink" title="23 SpringBoot案例-topic模式"></a>23 SpringBoot案例-topic模式</h2><p>之前的绑定我们都是写的配置类，其实通过注解的方式也可以实现配置类</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210321112301.png" alt="image-20210321112301901"></p>
<p>作者推荐还是通过配置类来完成</p>
<h2 id="24-高级-过期时间TTL"><a href="#24-高级-过期时间TTL" class="headerlink" title="24 高级-过期时间TTL"></a>24 高级-过期时间TTL</h2><p>过期时间TTL表示可以对消息设置预期的时间，在这个时间内都可以被消费者接收获取；过了之后消息将自动被删除。RabbitMQ可以对<strong>消息和队列</strong>设置TTL。目前有两种方法可以设置。</p>
<ul>
<li><p>第一种方法是通过队列属性设置，队列中所有消息都有相同的过期时间。</p>
</li>
<li><p>第二种方法是对消息进行单独设置，每条消息TTL可以不同。</p>
<p>如果上述两种方法同时使用，则消息的过期时间以两者之间TTL较小的那个数值为准。消息在队列的生存时间一旦超过设置的TTL值，<strong>就称为dead message被投递到死信队列</strong>， 消费者将无法再收到该消息。</p>
</li>
</ul>
<h2 id="25-高级-消息确认机制的配置"><a href="#25-高级-消息确认机制的配置" class="headerlink" title="25 高级-消息确认机制的配置"></a>25 高级-消息确认机制的配置</h2><p>NONE值是禁用发布确认模式，是默认值<br>CORRELATED值是发布消息成功到交换器后会触发回调方法，如1示例<br>SIMPLE值经测试有两种效果，其一效果和CORRELATED值一样会触发回调方法，其二在发布消息成功后使用rabbitTemplate调用waitForConfirms或waitForConfirmsOrDie方法等待broker节点返回发送结果，根据返回结果来判定下一步的逻辑，要注意的点是waitForConfirmsOrDie方法如果返回false则会关闭channel，则接下来无法发送消息到broker;</p>
<h2 id="26-死信队列"><a href="#26-死信队列" class="headerlink" title="26 死信队列"></a>26 死信队列</h2><p>DLX，全称为Dead-Letter-Exchange , 可以称之为死信交换机，也有人称之为死信邮箱。当消息在一个队列中变成死信(dead message)之后，它能被重新发送到另一个交换机中，这个交换机就是DLX ，绑定DLX的队列就称之为<strong>死信队列</strong>。<br>消息变成死信，可能是由于以下的原因</p>
<ul>
<li>消息被拒绝</li>
<li>消息过期</li>
<li>队列达到最大长度</li>
</ul>
<p>DLX也是一个正常的交换机，和一般的交换机没有区别，它能在任何的队列上被指定，实际上就是设置某一个队列的属性。当这个队列中存在死信时，Rabbitmq就会自动地将这个消息重新发布到设置的DLX上去，进而被路由到另一个队列，即死信队列。<br>要想使用死信队列，只需要在定义队列的时候设置队列参数 <code>x-dead-letter-exchange</code> 指定交换机即可。</p>
<h2 id="27-持久化机制和内存磁盘的监控"><a href="#27-持久化机制和内存磁盘的监控" class="headerlink" title="27 持久化机制和内存磁盘的监控"></a>27 持久化机制和内存磁盘的监控</h2><h3 id="内存警告"><a href="#内存警告" class="headerlink" title="内存警告"></a>内存警告</h3><p>当内存使用超过配置的阈值或者磁盘空间剩余空间对于配置的阈值时，RabbitMQ会暂时阻塞客户端的连接，并且停止接收从客户端发来的消息，以此避免服务器的崩溃，客户端与服务端的心态检测机制也会失效。<br>如下图：</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323200758.png" alt="img"></p>
<h3 id="02、RabbitMQ的内存控制"><a href="#02、RabbitMQ的内存控制" class="headerlink" title="02、RabbitMQ的内存控制"></a>02、RabbitMQ的内存控制</h3><p>参考帮助文档：<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/configure.html">https://www.rabbitmq.com/configure.html</a><br>当出现警告的时候，可以通过配置去修改和调整</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_vm_memory_high_watermark &lt;fraction&gt;rabbitmqctl set_vm_memory_high_watermark absolute 50MB</span><br></pre></td></tr></table></figure>

<p>fraction&#x2F;value 为内存阈值。默认情况是：0.4&#x2F;2GB，代表的含义是：当RabbitMQ的内存超过40%时，就会产生警告并且阻塞所有生产者的连接。通过此命令修改阈值在Broker重启以后将会失效，通过修改配置文件方式设置的阈值则不会随着重启而消失，但修改了配置文件一样要重启broker才会生效。</p>
<h2 id="28-内存磁盘的监控"><a href="#28-内存磁盘的监控" class="headerlink" title="28 内存磁盘的监控"></a>28 内存磁盘的监控</h2><h3 id="rabbitmq的内存换页"><a href="#rabbitmq的内存换页" class="headerlink" title="rabbitmq的内存换页"></a>rabbitmq的内存换页</h3><p>在某个Broker节点及内存阻塞生产者之前，它会尝试将队列中的消息换页到磁盘以释放内存空间，持久化和非持久化的消息都会写入磁盘中，其中持久化的消息本身就在磁盘中有一个副本，所以在转移的过程中持久化的消息会先从内存中清除掉。</p>
<p>比如有1000MB内存，当内存的使用率达到了400MB,已经达到了极限，但是因为配置的换页内存0.5，这个时候会在达到极限400mb之前，会把内存中的200MB进行转移到磁盘中。从而达到稳健的运行。</p>
<h2 id="29-集群"><a href="#29-集群" class="headerlink" title="29 集群"></a>29 集群</h2><p>RabbitMQ这款消息队列中间件产品本身是基于Erlang编写，Erlang语言天生具备分布式特性（通过同步Erlang集群各节点的magic cookie来实现）。因此，RabbitMQ天然支持Clustering。这使得RabbitMQ本身不需要像ActiveMQ、Kafka那样通过ZooKeeper分别来实现HA方案和保存集群的元数据。集群是保证可靠性的一种方式，同时可以通过水平扩展以达到增加消息吞吐量能力的目的。<br>在实际使用过程中多采取多机多实例部署方式，为了便于同学们练习搭建，有时候你不得不在一台机器上去搭建一个rabbitmq集群，本章主要针对单机多实例这种方式来进行开展。<br>主要参考官方文档：<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/clustering.html">https://www.rabbitmq.com/clustering.html</a></p>
<h2 id="30-分布式事务"><a href="#30-分布式事务" class="headerlink" title="30 分布式事务"></a>30 分布式事务</h2><p>分布式事务指事务的操作位于不同的节点上，需要保证事务的 AICD 特性。<br>例如在下单场景下，库存和订单如果不在同一个节点上，就涉及分布式事务。</p>
<p>两个事务都有各自的JVM，都有各自独立的数据库，如何保证两个事务数据的一致性，这就是分布式事务的问题</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323204334.png" alt="image-20210323204334170"></p>
<p><strong>一、两阶段提交（2PC）需要数据库产商的支持，java组件有atomikos</strong></p>
<p>两阶段提交（Two-phase Commit，2PC），通过引入协调者（Coordinator）来协调参与者的行为，并最终决定这些参与者是否要真正执行事务。</p>
<ul>
<li><p>2.1 同步阻塞 所有事务参与者在等待其它参与者响应的时候都处于同步阻塞状态，无法进行其它操作。</p>
</li>
<li><p>2.2 单点问题 协调者在 2PC 中起到非常大的作用，发生故障将会造成很大影响。特别是在阶段二发生故障，所有参与者会一直等待状态，无法完成其它操作。</p>
</li>
<li><p>2.3 数据不一致 在阶段二，如果协调者只发送了部分 Commit 消息，此时网络发生异常，那么只有部分参与者接收到 Commit 消息，也就是说只有部分参与者提交了事务，使得系统数据不一致。</p>
</li>
<li><p>2.4 太过保守 任意一个节点失败就会导致整个事务失败，没有完善的容错机制。</p>
<p>1.1准备阶段</p>
<p>协调者询问参与者事务是否执行成功，参与者发回事务执行结果。</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323204908.png" alt="img"></p>
<p>1.2 提交阶段<br>如果事务在每个参与者上都执行成功，事务协调者发送通知让参与者提交事务；否则，协调者发送通知让参与者回滚事务。<br>需要注意的是，在准备阶段，参与者执行了事务，但是还未提交。只有在提交阶段接收到协调者发来的通知后，才进行提交或者回滚。</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323204915.png" alt="img"></p>
</li>
</ul>
<p><strong>二、补偿事务（TCC） 严选，阿里，蚂蚁金服</strong></p>
<p>TCC 其实就是采用的补偿机制，其核心思想是：针对每个操作，都要注册一个与其对应的确认和补偿（撤销）操作。它分为三个阶段：</p>
<ul>
<li>Try 阶段主要是对业务系统做检测及资源预留</li>
<li>Confirm 阶段主要是对业务系统做确认提交，Try阶段执行成功并开始执行 Confirm阶段时，默认 - - - Confirm阶段是不会出错的。即：只要Try成功，Confirm一定成功。</li>
<li>Cancel 阶段主要是在业务执行错误，需要回滚的状态下执行的业务取消，预留资源释放。</li>
</ul>
<blockquote>
<p>举个例子，假入 Bob 要向 Smith 转账，思路大概是： 我们有一个本地方法，里面依次调用<br>1：首先在 Try 阶段，要先调用远程接口把 Smith 和 Bob 的钱给冻结起来。<br>2：在 Confirm 阶段，执行远程调用的转账的操作，转账成功进行解冻。<br>3：如果第2步执行成功，那么转账成功，如果第二步执行失败，则调用远程冻结接口对应的解冻方法 (Cancel)。</p>
</blockquote>
<p><strong>四、MQ 事务消息 异步场景，通用性较强，拓展性较高。</strong></p>
<p>有一些第三方的MQ是支持事务消息的，比如RocketMQ，他们支持事务消息的方式也是类似于采用的二阶段提交，但是市面上一些主流的MQ都是不支持事务消息的，比如 Kafka 不支持。<br>以阿里的 RabbitMQ 中间件为例，其思路大致为：</p>
<ul>
<li><p>第一阶段Prepared消息，会拿到消息的地址。 第二阶段执行本地事务，第三阶段通过第一阶段拿到的地址去访问消息，并修改状态。</p>
</li>
<li><p>也就是说在业务方法内要想消息队列提交两次请求，一次发送消息和一次确认消息。如果确认消息发送失败了RabbitMQ会定期扫描消息集群中的事务消息，这时候发现了Prepared消息，它会向消息发送者确认，所以生产方需要实现一个check接口，RabbitMQ会根据发送端设置的策略来决定是回滚还是继续发送确认消息。这样就保证了消息发送与本地事务同时成功或同时失败。</p>
</li>
</ul>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323205324.png" alt="img"></p>
<p>优点： 实现了最终一致性，不需要依赖本地数据库事务。<br>缺点： 实现难度大，主流MQ不支持，RocketMQ事务消息部分代码也未开源。</p>
<h3 id="分布式事务的完整架构图"><a href="#分布式事务的完整架构图" class="headerlink" title="分布式事务的完整架构图"></a>分布式事务的完整架构图</h3><p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323205544.png" alt="img"></p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323205635.png" alt="img"></p>
<p>上面这种消息传送机制，如果订单服务出现了问题，订单服务进行回滚，但是配送业务不会进行回滚，可能带来数据不一致的问题，我们采用RabbitMQ来解决分布式事务</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323212142.png" alt="img"></p>
<p>消息的生产问题和消费问题<br>生产可靠性的解决，增加一个冗余记录表，如果消息状态没有变为1，那么就进行重发操作</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323212721.png" alt="img"></p>
<p>我们可以设置重适次数，默认重试次数为3</p>
<p><strong>基于MQ的分布式事务消息的消息重发</strong></p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323221928.png" alt="img"></p>
<p><strong>基于MQ的分布式事务消息的死信队列消息转移 + 人工处理</strong></p>
<p>重试机制存在一个问题，如果消费者在消费的时候出现了异常状况，比如说1&#x2F;0，此时会不间断的进行重试，可能导致死循环。<br>解决重试的方案：<br>1 控制重试次数+死信队列<br>2 写try-catch块，调用baseNack，不进行重试,也就是count&lt;&#x3D;3的时候就重试。此时重试次数的配置就失效了，全局配置的重试次数就失效了</p>
<p><img src="https://typorayuimages.oss-cn-hangzhou.aliyuncs.com/fx/img/20210323222006.png" alt="img"></p>
<p>在死信队列发生了异常，我们就进行人工干预<br>幂等性：考虑数据的一致性</p>
<p>使用MQ保证消息数据的一致性，是业内比较认可的方法</p>
<p><strong>基于MQ的分布式事务解决方案优点：</strong></p>
<p>1、通用性强<br>2、拓展方便<br>3、耦合度低，方案也比较成熟</p>
<p><strong>基于MQ的分布式事务解决方案缺点：</strong></p>
<p>1、基于消息中间件，只适合异步场景<br>2、消息会延迟处理，需要业务上能够容忍</p>
<p>建议</p>
<p>1、尽量去避免分布式事务<br>2、尽量将非核心业务做成异步</p>
<h2 id="31-SpringBoot整合RabbitMQ集群配置详解"><a href="#31-SpringBoot整合RabbitMQ集群配置详解" class="headerlink" title="31 SpringBoot整合RabbitMQ集群配置详解"></a>31 SpringBoot整合RabbitMQ集群配置详解</h2><h2 id="32-集群监控"><a href="#32-集群监控" class="headerlink" title="32 集群监控"></a>32 集群监控</h2><h2 id="33-面试题分析"><a href="#33-面试题分析" class="headerlink" title="33 面试题分析"></a>33 面试题分析</h2><p><strong>面试题：1、Rabbitmq 为什么需要信道，为什么不是TCP直接通信</strong></p>
<blockquote>
<p>1、TCP的创建和销毁，开销大，创建要三次握手，销毁要4次分手。</p>
<p>2、如果不用信道，那应用程序就会TCP连接到Rabbit服务器，高峰时每秒成千上万连接就会造成资源的巨大浪费，而且底层操作系统每秒处理tcp连接数也是有限制的，必定造成性能瓶颈。</p>
<p>3、信道的原理是一条线程一条信道，多条线程多条信道同用一条TCP连接，一条TCP连接可以容纳无限的信道，即使每秒成千上万的请求也不会成为性能瓶颈。</p>
</blockquote>
<p><strong>2：queue队列到底在消费者创建还是生产者创建？</strong></p>
<blockquote>
<p>1： 一般建议是在rabbitmq操作面板创建。这是一种稳妥的做法。<br>2：按照常理来说，确实应该消费者这边创建是最好，消息的消费是在这边。这样你承受一个后果，可能我生产在生产消息可能会丢失消息。<br>3：在生产者创建队列也是可以，这样稳妥的方法，消息是不会出现丢失。<br>4：如果你生产者和消费都创建的队列，谁先启动谁先创建，后面启动就覆盖前面的</p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/01/19/note/go%E8%AF%AD%E8%A8%80/" rel="prev" title="go语言入门">
      <i class="fa fa-chevron-left"></i> go语言入门
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/22/note/MySQL%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95-InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-%E7%AC%94%E8%AE%B0/" rel="next" title="MySQL体系和存储引擎-读书笔记">
      MySQL体系和存储引擎-读书笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#RabbitMq-%E7%8B%82%E7%A5%9E%E8%AF%B4Java"><span class="nav-number">1.</span> <span class="nav-text">RabbitMq-狂神说Java</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">1 什么是中间件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%9E%B6%E6%9E%84%E6%8A%80%E6%9C%AF"><span class="nav-number">1.2.</span> <span class="nav-text">2 中间件以及架构技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.1.</span> <span class="nav-text">分布式中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.2.</span> <span class="nav-text">负载均衡中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">缓存中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.2.4.</span> <span class="nav-text">数据库中间件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%9F%BA%E4%BA%8E%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="nav-number">1.3.</span> <span class="nav-text">3 基于消息中间件的分布式系统的架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.4.</span> <span class="nav-text">4 消息队列协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AMQP%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.4.1.</span> <span class="nav-text">AMQP协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">1.5.</span> <span class="nav-text">5 消息队列持久化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%B6%88%E6%81%AF%E7%9A%84%E5%88%86%E5%8F%91%E7%AD%96%E7%95%A5"><span class="nav-number">1.6.</span> <span class="nav-text">6 消息的分发策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E6%B6%88%E6%81%AF%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E9%AB%98%E5%8F%AF%E9%9D%A0"><span class="nav-number">1.7.</span> <span class="nav-text">7 消息的高可用和高可靠</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-RabbitMQ%E5%85%A5%E9%97%A8%E5%92%8C%E5%AE%89%E8%A3%85"><span class="nav-number">1.8.</span> <span class="nav-text">8 RabbitMQ入门和安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85rabbitMQ"><span class="nav-number">1.8.1.</span> <span class="nav-text">安装rabbitMQ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-web%E5%9B%BE%E5%83%8F%E5%8C%96%E5%AE%89%E8%A3%85"><span class="nav-number">1.9.</span> <span class="nav-text">9 web图像化安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-docker%E5%AE%89%E8%A3%85rabbitMQ"><span class="nav-number">1.10.</span> <span class="nav-text">10 docker安装rabbitMQ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-RabbitMQ%E8%A7%92%E8%89%B2%E5%88%86%E7%B1%BB"><span class="nav-number">1.11.</span> <span class="nav-text">11 RabbitMQ角色分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-rabbitMQ%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-simple%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.12.</span> <span class="nav-text">12 rabbitMQ入门案例 -simple简单模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E4%BB%80%E4%B9%88%E6%98%AFAMQP"><span class="nav-number">1.13.</span> <span class="nav-text">13 什么是AMQP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-RabibitMQ%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E6%88%90"><span class="nav-number">1.14.</span> <span class="nav-text">14 RabibitMQ的核心组成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RabbitMQ%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="nav-number">1.14.1.</span> <span class="nav-text">RabbitMQ整体架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.14.2.</span> <span class="nav-text">运行流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F-fanout%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.15.</span> <span class="nav-text">15 发布订阅模式-fanout模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F-direct%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.16.</span> <span class="nav-text">16 路由模式-direct模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%BC%8F-topic%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.17.</span> <span class="nav-text">17 主题模式-topic模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-work%E6%A8%A1%E5%BC%8F-%E8%BD%AE%E8%AE%AD%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.18.</span> <span class="nav-text">18 work模式-轮训模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-work%E6%A8%A1%E5%BC%8F-%E5%85%AC%E5%B9%B3%E5%88%86%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.19.</span> <span class="nav-text">19 work模式-公平分发模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-RabbitMQ%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.20.</span> <span class="nav-text">20 RabbitMQ使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E8%80%A6%E3%80%81%E5%89%8A%E5%B3%B0%E3%80%81%E5%BC%82%E6%AD%A5"><span class="nav-number">1.20.1.</span> <span class="nav-text">解耦、削峰、异步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E5%86%85%E8%81%9A%E3%80%81%E4%BD%8E%E8%80%A6%E5%90%88"><span class="nav-number">1.20.2.</span> <span class="nav-text">高内聚、低耦合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-SpringBoot%E6%A1%88%E4%BE%8B-fanout%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.21.</span> <span class="nav-text">21 SpringBoot案例- fanout模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-springboot%E6%A1%88%E4%BE%8B-direct%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.22.</span> <span class="nav-text">22 springboot案例-direct模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-SpringBoot%E6%A1%88%E4%BE%8B-topic%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.23.</span> <span class="nav-text">23 SpringBoot案例-topic模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-%E9%AB%98%E7%BA%A7-%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4TTL"><span class="nav-number">1.24.</span> <span class="nav-text">24 高级-过期时间TTL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-%E9%AB%98%E7%BA%A7-%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.25.</span> <span class="nav-text">25 高级-消息确认机制的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97"><span class="nav-number">1.26.</span> <span class="nav-text">26 死信队列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%E5%92%8C%E5%86%85%E5%AD%98%E7%A3%81%E7%9B%98%E7%9A%84%E7%9B%91%E6%8E%A7"><span class="nav-number">1.27.</span> <span class="nav-text">27 持久化机制和内存磁盘的监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E8%AD%A6%E5%91%8A"><span class="nav-number">1.27.1.</span> <span class="nav-text">内存警告</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02%E3%80%81RabbitMQ%E7%9A%84%E5%86%85%E5%AD%98%E6%8E%A7%E5%88%B6"><span class="nav-number">1.27.2.</span> <span class="nav-text">02、RabbitMQ的内存控制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#28-%E5%86%85%E5%AD%98%E7%A3%81%E7%9B%98%E7%9A%84%E7%9B%91%E6%8E%A7"><span class="nav-number">1.28.</span> <span class="nav-text">28 内存磁盘的监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rabbitmq%E7%9A%84%E5%86%85%E5%AD%98%E6%8D%A2%E9%A1%B5"><span class="nav-number">1.28.1.</span> <span class="nav-text">rabbitmq的内存换页</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#29-%E9%9B%86%E7%BE%A4"><span class="nav-number">1.29.</span> <span class="nav-text">29 集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#30-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="nav-number">1.30.</span> <span class="nav-text">30 分布式事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="nav-number">1.30.1.</span> <span class="nav-text">分布式事务的完整架构图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#31-SpringBoot%E6%95%B4%E5%90%88RabbitMQ%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="nav-number">1.31.</span> <span class="nav-text">31 SpringBoot整合RabbitMQ集群配置详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32-%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7"><span class="nav-number">1.32.</span> <span class="nav-text">32 集群监控</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#33-%E9%9D%A2%E8%AF%95%E9%A2%98%E5%88%86%E6%9E%90"><span class="nav-number">1.33.</span> <span class="nav-text">33 面试题分析</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">qianguang</p>
  <div class="site-description" itemprop="description">浅光的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qianguang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='34,34,34' opacity='0.5' zIndex='-1' count='120' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
